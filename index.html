<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Booking Manager</title>
    <style>
        :root {
            --color-background: #fcfcf9;
            --color-surface: #fffffd;
            --color-text: #13343b;
            --color-text-secondary: #626c71;
            --color-primary: #21808d;
            --color-primary-hover: #1d7480;
            --color-border: rgba(94, 82, 64, 0.2);
            --color-card-border: rgba(94, 82, 64, 0.12);
            --color-error: #c0152f;
            --color-success: #21808d;
            --color-warning: #a84b2f;
            --radius-base: 8px;
            --radius-lg: 12px;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-24: 24px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-background: #1f2121;
                --color-surface: #262828;
                --color-text: #f5f5f5;
                --color-text-secondary: rgba(167, 169, 169, 0.7);
                --color-primary: #32b8c6;
                --color-primary-hover: #2da6b2;
                --color-border: rgba(119, 124, 124, 0.3);
                --color-card-border: rgba(119, 124, 124, 0.2);
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--color-background);
            color: var(--color-text);
            padding: var(--space-24);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            font-size: 28px;
            margin-bottom: var(--space-24);
            color: var(--color-text);
        }

        .tabs {
            display: flex;
            gap: var(--space-8);
            margin-bottom: var(--space-24);
            border-bottom: 2px solid var(--color-border);
            padding-bottom: 0;
        }

        .tab {
            padding: var(--space-12) var(--space-24);
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            margin-bottom: -2px;
        }

        .tab:hover {
            color: var(--color-text);
        }

        .tab.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-24);
            margin-bottom: var(--space-24);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-16);
            margin-bottom: var(--space-16);
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--color-text);
        }

        input, select, textarea {
            padding: var(--space-8) var(--space-12);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            font-size: 14px;
            background: var(--color-surface);
            color: var(--color-text);
            transition: border-color 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .btn {
            padding: var(--space-8) var(--space-16);
            border: none;
            border-radius: var(--radius-base);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: var(--color-surface);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            background: rgba(94, 82, 64, 0.05);
        }

        .btn-danger {
            background: var(--color-error);
            color: white;
        }

        .btn-small {
            padding: 4px 12px;
            font-size: 13px;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--space-16);
        }

        th, td {
            padding: var(--space-12);
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        th {
            background: rgba(33, 128, 141, 0.08);
            font-weight: 600;
            font-size: 13px;
            color: var(--color-text);
        }

        td {
            font-size: 14px;
        }

        tr:hover {
            background: rgba(33, 128, 141, 0.04);
        }

        .action-buttons {
            display: flex;
            gap: var(--space-8);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-16);
            margin-bottom: var(--space-24);
        }

        .stat-card {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-base);
            padding: var(--space-16);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .file-input-wrapper {
            display: inline-block;
        }

        .file-input {
            display: none;
        }

        .toolbar {
            display: flex;
            gap: var(--space-12);
            flex-wrap: wrap;
            margin-bottom: var(--space-16);
        }

        .room-type-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-8);
            margin-top: var(--space-12);
        }

        .room-type-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-12);
            background: rgba(33, 128, 141, 0.05);
            border-radius: var(--radius-base);
            border: 1px solid var(--color-border);
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: var(--space-8);
            margin-top: var(--space-16);
        }

        .inventory-date {
            padding: var(--space-12);
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            text-align: center;
        }

        .inventory-date .date {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .inventory-date .available {
            font-size: 18px;
            color: var(--color-primary);
            font-weight: 600;
        }

        .inventory-date .total {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .inventory-date.low {
            border-color: var(--color-warning);
        }

        .inventory-date.low .available {
            color: var(--color-warning);
        }

        .inventory-date.full {
            border-color: var(--color-error);
            opacity: 0.6;
        }

        .inventory-date.full .available {
            color: var(--color-error);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè® Hotel Booking Management Platform</h1>

        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="tab" onclick="showTab('hotels')">Hotels</button>
            <button class="tab" onclick="showTab('customers')">Customers</button>
            <button class="tab" onclick="showTab('bookings')">Bookings</button>
            <button class="tab" onclick="showTab('inventory')">Room Inventory</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalBookings">0</div>
                    <div class="stat-label">Total Bookings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalNights">0</div>
                    <div class="stat-label">Total Room Nights</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalRevenue">$0</div>
                    <div class="stat-label">Total Revenue</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeBookings">0</div>
                    <div class="stat-label">Active Bookings</div>
                </div>
            </div>

            <div class="card">
                <h2>Recent Bookings</h2>
                <div class="table-container">
                    <table id="recentBookingsTable">
                        <thead>
                            <tr>
                                <th>Customer</th>
                                <th>Hotel</th>
                                <th>Room Type</th>
                                <th>Check-in</th>
                                <th>Check-out</th>
                                <th>Nights</th>
                                <th>Total Cost</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div class="toolbar">
                <button class="btn btn-primary" onclick="exportToExcel()">üìä Export All Data to Excel</button>
            </div>
        </div>

        <!-- Hotels Tab -->
        <div id="hotels" class="tab-content">
            <div class="card">
                <h2>Add Hotel</h2>
                <form id="hotelForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="hotelName">Hotel Name *</label>
                            <input type="text" id="hotelName" required>
                        </div>
                        <div class="form-group">
                            <label for="hotelLocation">Location</label>
                            <input type="text" id="hotelLocation">
                        </div>
                        <div class="form-group">
                            <label for="hotelContact">Contact</label>
                            <input type="text" id="hotelContact">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Hotel</button>
                </form>

                <h3 style="margin-top: 24px;">Room Types</h3>
                <div class="form-grid" style="margin-top: 16px;">
                    <div class="form-group">
                        <label for="roomTypeName">Room Type Name *</label>
                        <input type="text" id="roomTypeName">
                    </div>
                    <div class="form-group">
                        <label for="roomTypeRate">Nightly Rate *</label>
                        <input type="number" id="roomTypeRate" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="roomTypeHotel">Hotel *</label>
                        <select id="roomTypeHotel"></select>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="addRoomType()">Add Room Type</button>

                <div id="roomTypesList" class="room-type-list"></div>
            </div>

            <div class="toolbar">
                <label class="btn btn-secondary file-input-wrapper">
                    üìÅ Import Hotels (CSV)
                    <input type="file" class="file-input" id="importHotels" accept=".csv" onchange="importHotels(event)">
                </label>
                <button class="btn btn-secondary" onclick="exportHotels()">üíæ Export Hotels</button>
            </div>

            <div class="card">
                <h2>Hotels List</h2>
                <div class="table-container">
                    <table id="hotelsTable">
                        <thead>
                            <tr>
                                <th>Hotel Name</th>
                                <th>Location</th>
                                <th>Contact</th>
                                <th>Room Types</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Customers Tab -->
        <div id="customers" class="tab-content">
            <div class="card">
                <h2>Add Customer</h2>
                <form id="customerForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="customerName">Customer Name *</label>
                            <input type="text" id="customerName" required>
                        </div>
                        <div class="form-group">
                            <label for="customerEmail">Email</label>
                            <input type="email" id="customerEmail">
                        </div>
                        <div class="form-group">
                            <label for="customerPhone">Phone</label>
                            <input type="tel" id="customerPhone">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Customer</button>
                </form>
            </div>

            <div class="toolbar">
                <label class="btn btn-secondary file-input-wrapper">
                    üìÅ Import Customers (CSV)
                    <input type="file" class="file-input" id="importCustomers" accept=".csv" onchange="importCustomers(event)">
                </label>
                <button class="btn btn-secondary" onclick="exportCustomers()">üíæ Export Customers</button>
            </div>

            <div class="card">
                <h2>Customers List</h2>
                <div class="table-container">
                    <table id="customersTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Total Bookings</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Bookings Tab -->
        <div id="bookings" class="tab-content">
            <div class="card">
                <h2>Create Booking</h2>
                <form id="bookingForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="bookingCustomer">Customer *</label>
                            <select id="bookingCustomer" required></select>
                        </div>
                        <div class="form-group">
                            <label for="bookingHotel">Hotel *</label>
                            <select id="bookingHotel" required onchange="updateRoomTypes()"></select>
                        </div>
                        <div class="form-group">
                            <label for="bookingRoomType">Room Type *</label>
                            <select id="bookingRoomType" required onchange="updateBookingRate()"></select>
                        </div>
                        <div class="form-group">
                            <label for="bookingCheckIn">Check-in Date *</label>
                            <input type="date" id="bookingCheckIn" required onchange="calculateNights()">
                        </div>
                        <div class="form-group">
                            <label for="bookingCheckOut">Check-out Date *</label>
                            <input type="date" id="bookingCheckOut" required onchange="calculateNights()">
                        </div>
                        <div class="form-group">
                            <label for="bookingNights">Total Nights</label>
                            <input type="number" id="bookingNights" readonly>
                        </div>
                        <div class="form-group">
                            <label for="bookingRate">Nightly Rate</label>
                            <input type="number" id="bookingRate" step="0.01" readonly>
                        </div>
                        <div class="form-group">
                            <label for="bookingTotal">Total Cost</label>
                            <input type="number" id="bookingTotal" readonly>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Create Booking</button>
                </form>
            </div>

            <div class="toolbar">
                <label class="btn btn-secondary file-input-wrapper">
                    üìÅ Import Bookings (CSV)
                    <input type="file" class="file-input" id="importBookings" accept=".csv" onchange="importBookings(event)">
                </label>
                <button class="btn btn-secondary" onclick="exportBookings()">üíæ Export Bookings</button>
            </div>

            <div class="card">
                <h2>Bookings List</h2>
                <div class="table-container">
                    <table id="bookingsTable">
                        <thead>
                            <tr>
                                <th>Booking ID</th>
                                <th>Customer</th>
                                <th>Hotel</th>
                                <th>Room Type</th>
                                <th>Check-in</th>
                                <th>Check-out</th>
                                <th>Nights</th>
                                <th>Rate/Night</th>
                                <th>Total Cost</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Room Inventory Tab -->
        <div id="inventory" class="tab-content">
            <div class="card">
                <h2>Manage Room Inventory</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="inventoryHotel">Hotel *</label>
                        <select id="inventoryHotel" onchange="loadInventory()"></select>
                    </div>
                    <div class="form-group">
                        <label for="inventoryRoomType">Room Type *</label>
                        <select id="inventoryRoomType" onchange="loadInventory()"></select>
                    </div>
                    <div class="form-group">
                        <label for="inventoryDate">Date *</label>
                        <input type="date" id="inventoryDate">
                    </div>
                    <div class="form-group">
                        <label for="inventoryTotal">Total Rooms Available *</label>
                        <input type="number" id="inventoryTotal" min="0">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="setInventory()">Set Inventory</button>
                <button class="btn btn-secondary" onclick="setInventoryRange()">Set for Date Range</button>
            </div>

            <div class="card">
                <h2>Room Availability Overview</h2>
                <div id="inventoryOverview">
                    <p style="color: var(--color-text-secondary);">Select a hotel and room type to view inventory.</p>
                </div>
            </div>

            <div class="card">
                <h2>Reconciliation Summary</h2>
                <div id="reconciliationSummary">
                    <p style="color: var(--color-text-secondary);">Select a hotel and room type to view reconciliation data.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Data Storage (Local Browser Database)
        let hotels = [];
        let customers = [];
        let bookings = [];
        let roomTypes = [];
        let inventory = {}; // { hotelId-roomTypeId-date: { total, booked } }

        // Initialize
        window.onload = function() {
            loadData();
        };

        function loadData() {
            const savedData = localStorage.getItem('hotelBookingData');
            if (savedData) {
                const data = JSON.parse(savedData);
                hotels = data.hotels || [];
                customers = data.customers || [];
                bookings = data.bookings || [];
                roomTypes = data.roomTypes || [];
                inventory = data.inventory || {};
            }
            initializeDropdowns();
            renderAll();
        }

        function saveData() {
            const data = {
                hotels,
                customers,
                bookings,
                roomTypes,
                inventory
            };
            localStorage.setItem('hotelBookingData', JSON.stringify(data));
        }

        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') {
                updateDashboard();
            }
        }

        // Hotel Management
        document.getElementById('hotelForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const hotel = {
                id: Date.now(),
                name: document.getElementById('hotelName').value,
                location: document.getElementById('hotelLocation').value,
                contact: document.getElementById('hotelContact').value
            };
            
            hotels.push(hotel);
            saveData();
            this.reset();
            renderAll();
            alert('Hotel added successfully!');
        });

        function addRoomType() {
            const name = document.getElementById('roomTypeName').value;
            const rate = parseFloat(document.getElementById('roomTypeRate').value);
            const hotelId = parseInt(document.getElementById('roomTypeHotel').value);

            if (!name || !rate || !hotelId) {
                alert('Please fill all room type fields');
                return;
            }

            const roomType = {
                id: Date.now(),
                name,
                rate,
                hotelId
            };

            roomTypes.push(roomType);
            saveData();
            document.getElementById('roomTypeName').value = '';
            document.getElementById('roomTypeRate').value = '';
            renderAll();
            alert('Room type added successfully!');
        }

        function renderHotels() {
            const tbody = document.querySelector('#hotelsTable tbody');
            tbody.innerHTML = '';
            hotels.forEach(hotel => {
                const hotelRoomTypes = roomTypes.filter(rt => rt.hotelId === hotel.id);
                const roomTypesText = hotelRoomTypes.map(rt => `${rt.name} ($${rt.rate})`).join(', ') || 'None';
                const row = `
                    <tr>
                        <td>${hotel.name}</td>
                        <td>${hotel.location}</td>
                        <td>${hotel.contact}</td>
                        <td>${roomTypesText}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-small btn-danger" onclick="deleteHotel(${hotel.id})">Delete</button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function renderRoomTypes() {
            const container = document.getElementById('roomTypesList');
            container.innerHTML = '<h3 style="margin-top: 24px;">Current Room Types</h3>';
            
            roomTypes.forEach(rt => {
                const hotel = hotels.find(h => h.id === rt.hotelId);
                const item = document.createElement('div');
                item.className = 'room-type-item';
                item.innerHTML = `
                    <div>
                        <strong>${rt.name}</strong> at ${hotel ? hotel.name : 'Unknown Hotel'} - $${rt.rate}/night
                    </div>
                    <button class="btn btn-small btn-danger" onclick="deleteRoomType(${rt.id})">Delete</button>
                `;
                container.appendChild(item);
            });
        }

        function deleteHotel(id) {
            if (confirm('Delete this hotel? Associated room types and bookings will be affected.')) {
                hotels = hotels.filter(h => h.id !== id);
                roomTypes = roomTypes.filter(rt => rt.hotelId !== id);
                saveData();
                renderAll();
            }
        }

        function deleteRoomType(id) {
            if (confirm('Delete this room type?')) {
                roomTypes = roomTypes.filter(rt => rt.id !== id);
                saveData();
                renderAll();
            }
        }

        // Customer Management
        document.getElementById('customerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const customer = {
                id: Date.now(),
                name: document.getElementById('customerName').value,
                email: document.getElementById('customerEmail').value,
                phone: document.getElementById('customerPhone').value
            };
            
            customers.push(customer);
            saveData();
            this.reset();
            renderAll();
            alert('Customer added successfully!');
        });

        function renderCustomers() {
            const tbody = document.querySelector('#customersTable tbody');
            tbody.innerHTML = '';
            customers.forEach(customer => {
                const customerBookings = bookings.filter(b => b.customerId === customer.id);
                const row = `
                    <tr>
                        <td>${customer.name}</td>
                        <td>${customer.email}</td>
                        <td>${customer.phone}</td>
                        <td>${customerBookings.length}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-small btn-danger" onclick="deleteCustomer(${customer.id})">Delete</button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function deleteCustomer(id) {
            if (confirm('Delete this customer? Associated bookings will be affected.')) {
                customers = customers.filter(c => c.id !== id);
                saveData();
                renderAll();
            }
        }

        // Booking Management
        document.getElementById('bookingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const customerId = parseInt(document.getElementById('bookingCustomer').value);
            const hotelId = parseInt(document.getElementById('bookingHotel').value);
            const roomTypeId = parseInt(document.getElementById('bookingRoomType').value);
            const checkIn = document.getElementById('bookingCheckIn').value;
            const checkOut = document.getElementById('bookingCheckOut').value;
            const nights = parseInt(document.getElementById('bookingNights').value);
            const rate = parseFloat(document.getElementById('bookingRate').value);
            const total = parseFloat(document.getElementById('bookingTotal').value);

            // Check inventory availability
            const dates = getDateRange(checkIn, checkOut);
            for (let date of dates) {
                const key = `${hotelId}-${roomTypeId}-${date}`;
                const inv = inventory[key] || { total: 0, booked: 0 };
                if (inv.booked >= inv.total && inv.total > 0) {
                    alert(`No rooms available for ${date}. Please check inventory.`);
                    return;
                }
            }

            const booking = {
                id: Date.now(),
                customerId,
                hotelId,
                roomTypeId,
                checkIn,
                checkOut,
                nights,
                rate,
                total
            };

            bookings.push(booking);

            // Update inventory
            for (let date of dates) {
                const key = `${hotelId}-${roomTypeId}-${date}`;
                if (!inventory[key]) {
                    inventory[key] = { total: 0, booked: 0 };
                }
                inventory[key].booked++;
            }

            saveData();
            this.reset();
            renderAll();
            alert('Booking created successfully!');
        });

        function updateRoomTypes() {
            const hotelId = parseInt(document.getElementById('bookingHotel').value);
            const select = document.getElementById('bookingRoomType');
            select.innerHTML = '<option value="">Select Room Type</option>';
            
            const hotelRoomTypes = roomTypes.filter(rt => rt.hotelId === hotelId);
            hotelRoomTypes.forEach(rt => {
                const option = document.createElement('option');
                option.value = rt.id;
                option.textContent = `${rt.name} - $${rt.rate}/night`;
                option.dataset.rate = rt.rate;
                select.appendChild(option);
            });
        }

        function updateBookingRate() {
            const select = document.getElementById('bookingRoomType');
            const selectedOption = select.options[select.selectedIndex];
            if (selectedOption && selectedOption.dataset.rate) {
                document.getElementById('bookingRate').value = selectedOption.dataset.rate;
                calculateNights();
            }
        }

        function calculateNights() {
            const checkIn = document.getElementById('bookingCheckIn').value;
            const checkOut = document.getElementById('bookingCheckOut').value;
            const rate = parseFloat(document.getElementById('bookingRate').value) || 0;

            if (checkIn && checkOut) {
                const start = new Date(checkIn);
                const end = new Date(checkOut);
                const nights = Math.max(0, Math.floor((end - start) / (1000 * 60 * 60 * 24)));
                document.getElementById('bookingNights').value = nights;
                document.getElementById('bookingTotal').value = (nights * rate).toFixed(2);
            }
        }

        function renderBookings() {
            const tbody = document.querySelector('#bookingsTable tbody');
            tbody.innerHTML = '';
            bookings.forEach(booking => {
                const customer = customers.find(c => c.id === booking.customerId);
                const hotel = hotels.find(h => h.id === booking.hotelId);
                const roomType = roomTypes.find(rt => rt.id === booking.roomTypeId);
                
                const row = `
                    <tr>
                        <td>${booking.id}</td>
                        <td>${customer ? customer.name : 'Unknown'}</td>
                        <td>${hotel ? hotel.name : 'Unknown'}</td>
                        <td>${roomType ? roomType.name : 'Unknown'}</td>
                        <td>${booking.checkIn}</td>
                        <td>${booking.checkOut}</td>
                        <td>${booking.nights}</td>
                        <td>$${booking.rate.toFixed(2)}</td>
                        <td>$${booking.total.toFixed(2)}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-small btn-danger" onclick="deleteBooking(${booking.id})">Delete</button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function deleteBooking(id) {
            if (confirm('Delete this booking?')) {
                const booking = bookings.find(b => b.id === id);
                if (booking) {
                    // Update inventory
                    const dates = getDateRange(booking.checkIn, booking.checkOut);
                    for (let date of dates) {
                        const key = `${booking.hotelId}-${booking.roomTypeId}-${date}`;
                        if (inventory[key]) {
                            inventory[key].booked = Math.max(0, inventory[key].booked - 1);
                        }
                    }
                    
                    bookings = bookings.filter(b => b.id !== id);
                    saveData();
                    renderAll();
                }
            }
        }

        // Inventory Management
        function setInventory() {
            const hotelId = parseInt(document.getElementById('inventoryHotel').value);
            const roomTypeId = parseInt(document.getElementById('inventoryRoomType').value);
            const date = document.getElementById('inventoryDate').value;
            const total = parseInt(document.getElementById('inventoryTotal').value);

            if (!hotelId || !roomTypeId || !date || isNaN(total)) {
                alert('Please fill all fields');
                return;
            }

            const key = `${hotelId}-${roomTypeId}-${date}`;
            if (!inventory[key]) {
                inventory[key] = { total: 0, booked: 0 };
            }
            inventory[key].total = total;

            saveData();
            loadInventory();
            alert('Inventory updated successfully!');
        }

        function setInventoryRange() {
            const hotelId = parseInt(document.getElementById('inventoryHotel').value);
            const roomTypeId = parseInt(document.getElementById('inventoryRoomType').value);
            const total = parseInt(document.getElementById('inventoryTotal').value);

            if (!hotelId || !roomTypeId || isNaN(total)) {
                alert('Please select hotel, room type and total rooms');
                return;
            }

            const startDate = prompt('Enter start date (YYYY-MM-DD):');
            const endDate = prompt('Enter end date (YYYY-MM-DD):');

            if (!startDate || !endDate) return;

            const dates = getDateRange(startDate, endDate, true);
            
            for (let date of dates) {
                const key = `${hotelId}-${roomTypeId}-${date}`;
                if (!inventory[key]) {
                    inventory[key] = { total: 0, booked: 0 };
                }
                inventory[key].total = total;
            }

            saveData();
            loadInventory();
            alert(`Inventory set for ${dates.length} dates`);
        }

        function loadInventory() {
            const hotelId = parseInt(document.getElementById('inventoryHotel').value);
            const roomTypeId = parseInt(document.getElementById('inventoryRoomType').value);

            if (!hotelId || !roomTypeId) {
                document.getElementById('inventoryOverview').innerHTML = '<p style="color: var(--color-text-secondary);">Select a hotel and room type to view inventory.</p>';
                document.getElementById('reconciliationSummary').innerHTML = '<p style="color: var(--color-text-secondary);">Select a hotel and room type to view reconciliation data.</p>';
                return;
            }

            const hotel = hotels.find(h => h.id === hotelId);
            const roomType = roomTypes.find(rt => rt.id === roomTypeId);

            // Show next 30 days
            const today = new Date();
            const dates = [];
            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() + i);
                dates.push(date.toISOString().split('T')[0]);
            }

            let html = `<h3>${hotel.name} - ${roomType.name}</h3><div class="inventory-grid">`;
            let totalAvailable = 0;
            let totalBooked = 0;
            let totalCapacity = 0;
            let lowDates = [];
            let fullDates = [];

            dates.forEach(date => {
                const key = `${hotelId}-${roomTypeId}-${date}`;
                const inv = inventory[key] || { total: 0, booked: 0 };
                const available = inv.total - inv.booked;
                const dateObj = new Date(date);
                const formattedDate = `${dateObj.getMonth() + 1}/${dateObj.getDate()}`;

                totalAvailable += available;
                totalBooked += inv.booked;
                totalCapacity += inv.total;

                let className = 'inventory-date';
                if (inv.total > 0 && available === 0) {
                    className += ' full';
                    fullDates.push(formattedDate);
                } else if (inv.total > 0 && available <= inv.total * 0.2) {
                    className += ' low';
                    lowDates.push(formattedDate);
                }

                html += `
                    <div class="${className}">
                        <div class="date">${formattedDate}</div>
                        <div class="available">${available}</div>
                        <div class="total">of ${inv.total}</div>
                    </div>
                `;
            });

            html += '</div>';
            document.getElementById('inventoryOverview').innerHTML = html;

            // Reconciliation Summary
            let reconcileHtml = `
                <h3>30-Day Summary</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${totalCapacity}</div>
                        <div class="stat-label">Total Room Nights</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${totalBooked}</div>
                        <div class="stat-label">Booked</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${totalAvailable}</div>
                        <div class="stat-label">Available</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${totalCapacity > 0 ? ((totalBooked / totalCapacity) * 100).toFixed(1) : 0}%</div>
                        <div class="stat-label">Occupancy Rate</div>
                    </div>
                </div>
            `;

            if (lowDates.length > 0) {
                reconcileHtml += `<p style="color: var(--color-warning); margin-top: 16px;"><strong>‚ö†Ô∏è Low Availability:</strong> ${lowDates.join(', ')}</p>`;
            }
            if (fullDates.length > 0) {
                reconcileHtml += `<p style="color: var(--color-error); margin-top: 8px;"><strong>üî¥ Fully Booked:</strong> ${fullDates.join(', ')}</p>`;
            }

            document.getElementById('reconciliationSummary').innerHTML = reconcileHtml;
        }

        // Dashboard
        function updateDashboard() {
            document.getElementById('totalBookings').textContent = bookings.length;
            
            const totalNights = bookings.reduce((sum, b) => sum + b.nights, 0);
            document.getElementById('totalNights').textContent = totalNights;
            
            const totalRevenue = bookings.reduce((sum, b) => sum + b.total, 0);
            document.getElementById('totalRevenue').textContent = `$${totalRevenue.toFixed(2)}`;
            
            const today = new Date().toISOString().split('T')[0];
            const activeBookings = bookings.filter(b => b.checkOut >= today && b.checkIn <= today);
            document.getElementById('activeBookings').textContent = activeBookings.length;

            // Recent bookings
            const tbody = document.querySelector('#recentBookingsTable tbody');
            tbody.innerHTML = '';
            const recentBookings = [...bookings].slice(-10).reverse();
            recentBookings.forEach(booking => {
                const customer = customers.find(c => c.id === booking.customerId);
                const hotel = hotels.find(h => h.id === booking.hotelId);
                const roomType = roomTypes.find(rt => rt.id === booking.roomTypeId);
                
                const row = `
                    <tr>
                        <td>${customer ? customer.name : 'Unknown'}</td>
                        <td>${hotel ? hotel.name : 'Unknown'}</td>
                        <td>${roomType ? roomType.name : 'Unknown'}</td>
                        <td>${booking.checkIn}</td>
                        <td>${booking.checkOut}</td>
                        <td>${booking.nights}</td>
                        <td>$${booking.total.toFixed(2)}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // Helper Functions
        function getDateRange(start, end, includeEnd = false) {
            const dates = [];
            const startDate = new Date(start);
            const endDate = new Date(end);
            
            const current = new Date(startDate);
            while (current < endDate) {
                dates.push(current.toISOString().split('T')[0]);
                current.setDate(current.getDate() + 1);
            }
            
            if (includeEnd) {
                dates.push(endDate.toISOString().split('T')[0]);
            }
            
            return dates;
        }

        function initializeDropdowns() {
            updateHotelDropdowns();
            updateCustomerDropdowns();
        }

        function updateHotelDropdowns() {
            const selects = ['bookingHotel', 'roomTypeHotel', 'inventoryHotel'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">Select Hotel</option>';
                hotels.forEach(hotel => {
                    const option = document.createElement('option');
                    option.value = hotel.id;
                    option.textContent = hotel.name;
                    select.appendChild(option);
                });
            });

            // Update inventory room type dropdown when hotel changes
            document.getElementById('inventoryHotel').addEventListener('change', function() {
                const hotelId = parseInt(this.value);
                const select = document.getElementById('inventoryRoomType');
                select.innerHTML = '<option value="">Select Room Type</option>';
                if (hotelId) {
                    const hotelRoomTypes = roomTypes.filter(rt => rt.hotelId === hotelId);
                    hotelRoomTypes.forEach(rt => {
                        const option = document.createElement('option');
                        option.value = rt.id;
                        option.textContent = rt.name;
                        select.appendChild(option);
                    });
                }
            });
        }

        function updateCustomerDropdowns() {
            const select = document.getElementById('bookingCustomer');
            select.innerHTML = '<option value="">Select Customer</option>';
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = customer.name;
                select.appendChild(option);
            });
        }

        function renderAll() {
            renderHotels();
            renderRoomTypes();
            renderCustomers();
            renderBookings();
            updateHotelDropdowns();
            updateCustomerDropdowns();
            updateDashboard();
        }

        // Import/Export Functions
        function importHotels(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const lines = text.split('\n').filter(line => line.trim());
                const headers = lines[0].split(',').map(h => h.trim());
                
                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',').map(v => v.trim());
                    const hotel = {
                        id: Date.now() + i,
                        name: values[0] || '',
                        location: values[1] || '',
                        contact: values[2] || ''
                    };
                    hotels.push(hotel);
                }
                
                saveData();
                renderAll();
                alert(`Imported ${lines.length - 1} hotels`);
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function exportHotels() {
            const csv = ['Hotel Name,Location,Contact'];
            hotels.forEach(hotel => {
                csv.push(`${hotel.name},${hotel.location},${hotel.contact}`);
            });
            downloadCSV(csv.join('\n'), 'hotels.csv');
        }

        function importCustomers(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const lines = text.split('\n').filter(line => line.trim());
                
                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',').map(v => v.trim());
                    const customer = {
                        id: Date.now() + i,
                        name: values[0] || '',
                        email: values[1] || '',
                        phone: values[2] || ''
                    };
                    customers.push(customer);
                }
                
                saveData();
                renderAll();
                alert(`Imported ${lines.length - 1} customers`);
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function exportCustomers() {
            const csv = ['Customer Name,Email,Phone'];
            customers.forEach(customer => {
                csv.push(`${customer.name},${customer.email},${customer.phone}`);
            });
            downloadCSV(csv.join('\n'), 'customers.csv');
        }

        function importBookings(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const lines = text.split('\n').filter(line => line.trim());
                
                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',').map(v => v.trim());
                    const customerName = values[0];
                    const hotelName = values[1];
                    const roomTypeName = values[2];
                    
                    const customer = customers.find(c => c.name === customerName);
                    const hotel = hotels.find(h => h.name === hotelName);
                    const roomType = roomTypes.find(rt => rt.name === roomTypeName && rt.hotelId === (hotel ? hotel.id : null));
                    
                    if (customer && hotel && roomType) {
                        const checkIn = values[3];
                        const checkOut = values[4];
                        const nights = parseInt(values[5]) || 0;
                        const rate = parseFloat(values[6]) || roomType.rate;
                        const total = parseFloat(values[7]) || (nights * rate);
                        
                        const booking = {
                            id: Date.now() + i,
                            customerId: customer.id,
                            hotelId: hotel.id,
                            roomTypeId: roomType.id,
                            checkIn,
                            checkOut,
                            nights,
                            rate,
                            total
                        };
                        bookings.push(booking);

                        // Update inventory
                        const dates = getDateRange(checkIn, checkOut);
                        dates.forEach(date => {
                            const key = `${hotel.id}-${roomType.id}-${date}`;
                            if (!inventory[key]) {
                                inventory[key] = { total: 0, booked: 0 };
                            }
                            inventory[key].booked++;
                        });
                    }
                }
                
                saveData();
                renderAll();
                alert(`Imported ${lines.length - 1} bookings`);
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function exportBookings() {
            const csv = ['Customer,Hotel,Room Type,Check-in,Check-out,Nights,Rate/Night,Total Cost'];
            bookings.forEach(booking => {
                const customer = customers.find(c => c.id === booking.customerId);
                const hotel = hotels.find(h => h.id === booking.hotelId);
                const roomType = roomTypes.find(rt => rt.id === booking.roomTypeId);
                csv.push(`${customer ? customer.name : 'Unknown'},${hotel ? hotel.name : 'Unknown'},${roomType ? roomType.name : 'Unknown'},${booking.checkIn},${booking.checkOut},${booking.nights},${booking.rate},${booking.total}`);
            });
            downloadCSV(csv.join('\n'), 'bookings.csv');
        }

        function exportToExcel() {
            const wb = XLSX.utils.book_new();

            // Hotels sheet
            const hotelsData = hotels.map(h => ({
                'Hotel Name': h.name,
                'Location': h.location,
                'Contact': h.contact
            }));
            const hotelsSheet = XLSX.utils.json_to_sheet(hotelsData);
            XLSX.utils.book_append_sheet(wb, hotelsSheet, 'Hotels');

            // Room Types sheet
            const roomTypesData = roomTypes.map(rt => {
                const hotel = hotels.find(h => h.id === rt.hotelId);
                return {
                    'Room Type': rt.name,
                    'Hotel': hotel ? hotel.name : 'Unknown',
                    'Rate/Night': rt.rate
                };
            });
            const roomTypesSheet = XLSX.utils.json_to_sheet(roomTypesData);
            XLSX.utils.book_append_sheet(wb, roomTypesSheet, 'Room Types');

            // Customers sheet
            const customersData = customers.map(c => ({
                'Name': c.name,
                'Email': c.email,
                'Phone': c.phone
            }));
            const customersSheet = XLSX.utils.json_to_sheet(customersData);
            XLSX.utils.book_append_sheet(wb, customersSheet, 'Customers');

            // Bookings sheet
            const bookingsData = bookings.map(b => {
                const customer = customers.find(c => c.id === b.customerId);
                const hotel = hotels.find(h => h.id === b.hotelId);
                const roomType = roomTypes.find(rt => rt.id === b.roomTypeId);
                return {
                    'Booking ID': b.id,
                    'Customer': customer ? customer.name : 'Unknown',
                    'Hotel': hotel ? hotel.name : 'Unknown',
                    'Room Type': roomType ? roomType.name : 'Unknown',
                    'Check-in': b.checkIn,
                    'Check-out': b.checkOut,
                    'Nights': b.nights,
                    'Rate/Night': b.rate,
                    'Total Cost': b.total
                };
            });
            const bookingsSheet = XLSX.utils.json_to_sheet(bookingsData);
            XLSX.utils.book_append_sheet(wb, bookingsSheet, 'Bookings');

            // Inventory sheet
            const inventoryData = [];
            Object.keys(inventory).forEach(key => {
                const [hotelId, roomTypeId, date] = key.split('-');
                const hotel = hotels.find(h => h.id === parseInt(hotelId));
                const roomType = roomTypes.find(rt => rt.id === parseInt(roomTypeId));
                const inv = inventory[key];
                inventoryData.push({
                    'Date': date,
                    'Hotel': hotel ? hotel.name : 'Unknown',
                    'Room Type': roomType ? roomType.name : 'Unknown',
                    'Total Rooms': inv.total,
                    'Booked': inv.booked,
                    'Available': inv.total - inv.booked
                });
            });
            const inventorySheet = XLSX.utils.json_to_sheet(inventoryData);
            XLSX.utils.book_append_sheet(wb, inventorySheet, 'Inventory');

            XLSX.writeFile(wb, 'hotel_booking_data.xlsx');
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
