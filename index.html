<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Booking Management Platform</title>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-500: rgba(168, 75, 47, 1);
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-success: var(--color-teal-500);
            --color-error: var(--color-red-500);
            --font-family-base: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --radius-base: 8px;
            --radius-lg: 12px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-gray-200-rgb: 245, 245, 245;
                --color-gray-400-rgb: 119, 124, 124;
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(var(--color-gray-200-rgb), 0.7);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family-base);
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.6;
            padding: var(--space-20);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            margin-bottom: var(--space-24);
            padding-bottom: var(--space-16);
            border-bottom: 2px solid var(--color-border);
        }

        h1 {
            font-size: 28px;
            margin-bottom: var(--space-8);
        }

        .tabs {
            display: flex;
            gap: var(--space-8);
            margin-bottom: var(--space-24);
            flex-wrap: wrap;
        }

        .tab {
            padding: var(--space-12) var(--space-20);
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .tab:hover {
            background-color: var(--color-primary);
            color: white;
        }

        .tab.active {
            background-color: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background-color: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-20);
            margin-bottom: var(--space-20);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-16);
            margin-bottom: var(--space-16);
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: var(--space-8);
            font-weight: 500;
            font-size: 14px;
        }

        input, select, textarea {
            padding: var(--space-12);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            font-size: 14px;
            background-color: var(--color-surface);
            color: var(--color-text);
        }

        input:focus, select:focus, textarea:focus {
            outline: 2px solid var(--color-primary);
            border-color: var(--color-primary);
        }

        .btn {
            padding: var(--space-12) var(--space-20);
            border: none;
            border-radius: var(--radius-base);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--color-primary-hover);
        }

        .btn-secondary {
            background-color: var(--color-surface);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-danger {
            background-color: var(--color-error);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: var(--space-8);
            flex-wrap: wrap;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--space-16);
        }

        th, td {
            padding: var(--space-12);
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        th {
            background-color: var(--color-surface);
            font-weight: 600;
        }

        tr:hover {
            background-color: rgba(var(--color-teal-500-rgb), 0.05);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-16);
            margin-bottom: var(--space-20);
        }

        .stat-card {
            background-color: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-base);
            padding: var(--space-16);
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: var(--space-8);
        }

        .stat-label {
            font-size: 14px;
            color: var(--color-text-secondary);
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .message {
            padding: var(--space-12);
            border-radius: var(--radius-base);
            margin-bottom: var(--space-16);
        }

        .message.success {
            background-color: rgba(var(--color-teal-500-rgb), 0.1);
            color: var(--color-success);
            border: 1px solid var(--color-success);
        }

        .message.error {
            background-color: rgba(192, 21, 47, 0.1);
            color: var(--color-error);
            border: 1px solid var(--color-error);
        }

        .action-btn {
            padding: var(--space-8) var(--space-12);
            font-size: 12px;
            cursor: pointer;
            margin-right: var(--space-8);
        }

        .search-box {
            margin-bottom: var(--space-16);
            width: 100%;
            max-width: 400px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üè® Hotel Booking Management Platform</h1>
            <p style="color: var(--color-text-secondary);">Manage bookings, customers, and hotels with comprehensive reporting</p>
        </header>

        <div id="message-container"></div>

        <div class="tabs">
            <button class="tab active" data-tab="dashboard">Dashboard</button>
            <button class="tab" data-tab="bookings">Bookings</button>
            <button class="tab" data-tab="customers">Customers</button>
            <button class="tab" data-tab="hotels">Hotels</button>
            <button class="tab" data-tab="import-export">Import/Export</button>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard-tab">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-bookings">0</div>
                    <div class="stat-label">Total Bookings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-customers">0</div>
                    <div class="stat-label">Total Customers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-hotels">0</div>
                    <div class="stat-label">Total Hotels</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-nights">0</div>
                    <div class="stat-label">Total Nights</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-revenue">$0</div>
                    <div class="stat-label">Total Revenue</div>
                </div>
            </div>

            <div class="card">
                <h2>Recent Bookings</h2>
                <div id="recent-bookings-table"></div>
            </div>

            <div class="card">
                <h2>Bookings by Hotel</h2>
                <div id="hotel-stats"></div>
            </div>
        </div>

        <!-- Bookings Tab -->
        <div class="tab-content" id="bookings-tab">
            <div class="card">
                <h2>Add New Booking</h2>
                <form id="booking-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="booking-customer">Customer *</label>
                            <select id="booking-customer" required>
                                <option value="">Select Customer</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="booking-hotel">Hotel *</label>
                            <select id="booking-hotel" required>
                                <option value="">Select Hotel</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="booking-checkin">Check-in Date *</label>
                            <input type="date" id="booking-checkin" required>
                        </div>
                        <div class="form-group">
                            <label for="booking-checkout">Check-out Date *</label>
                            <input type="date" id="booking-checkout" required>
                        </div>
                        <div class="form-group">
                            <label for="booking-rate">Nightly Rate ($) *</label>
                            <input type="number" id="booking-rate" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="booking-extra-rate">Extra Night Rate ($)</label>
                            <input type="number" id="booking-extra-rate" step="0.01" value="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="booking-notes">Notes</label>
                        <textarea id="booking-notes" rows="3"></textarea>
                    </div>
                    <div class="btn-group" style="margin-top: var(--space-16);">
                        <button type="submit" class="btn btn-primary">Add Booking</button>
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('booking-form').reset()">Clear</button>
                    </div>
                </form>
            </div>

            <div class="card">
                <h2>All Bookings</h2>
                <input type="text" id="search-bookings" class="search-box" placeholder="Search bookings...">
                <div id="bookings-table"></div>
            </div>
        </div>

        <!-- Customers Tab -->
        <div class="tab-content" id="customers-tab">
            <div class="card">
                <h2>Add New Customer</h2>
                <form id="customer-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="customer-name">Full Name *</label>
                            <input type="text" id="customer-name" required>
                        </div>
                        <div class="form-group">
                            <label for="customer-email">Email *</label>
                            <input type="email" id="customer-email" required>
                        </div>
                        <div class="form-group">
                            <label for="customer-phone">Phone</label>
                            <input type="tel" id="customer-phone">
                        </div>
                        <div class="form-group">
                            <label for="customer-company">Company</label>
                            <input type="text" id="customer-company">
                        </div>
                    </div>
                    <div class="btn-group" style="margin-top: var(--space-16);">
                        <button type="submit" class="btn btn-primary">Add Customer</button>
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('customer-form').reset()">Clear</button>
                    </div>
                </form>
            </div>

            <div class="card">
                <h2>All Customers</h2>
                <input type="text" id="search-customers" class="search-box" placeholder="Search customers...">
                <div id="customers-table"></div>
            </div>
        </div>

        <!-- Hotels Tab -->
        <div class="tab-content" id="hotels-tab">
            <div class="card">
                <h2>Add New Hotel</h2>
                <form id="hotel-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="hotel-name">Hotel Name *</label>
                            <input type="text" id="hotel-name" required>
                        </div>
                        <div class="form-group">
                            <label for="hotel-location">Location *</label>
                            <input type="text" id="hotel-location" required>
                        </div>
                        <div class="form-group">
                            <label for="hotel-standard-rate">Standard Rate ($)</label>
                            <input type="number" id="hotel-standard-rate" step="0.01">
                        </div>                    <div class="form-group">
                        <label for="hotel-rooms">Total Rooms</label>
                        <input type="number" id="hotel-rooms">
                    </div>
                </div>
                <div class="form-group">
                    <label for="hotel-amenities">Amenities</label>
                    <textarea id="hotel-amenities" rows="3"></textarea>
                </div>
                
                <h3 style="margin-top: var(--space-20); margin-bottom: var(--space-16);">Room Types</h3>
                <div id="room-types-container">
                    <div class="room-type-entry" style="display: grid; grid-template-columns: 2fr 1fr 1fr 60px; gap: var(--space-8); margin-bottom: var(--space-8); align-items: end;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>Room Type Name</label>
                            <input type="text" class="room-type-name" placeholder="e.g., Deluxe Suite">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>Available Rooms</label>
                            <input type="number" class="room-type-count" min="0" placeholder="0">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>Rate ($)</label>
                            <input type="number" class="room-type-rate" step="0.01" min="0" placeholder="0.00">
                        </div>
                        <button type="button" class="btn btn-danger" onclick="removeRoomType(this)" style="padding: var(--space-8);">‚úï</button>
                    </div>
                </div>
                <button type="button" class="btn btn-secondary" onclick="addRoomTypeField()" style="margin-top: var(--space-8);">+ Add Room Type</button>
                    <div class="btn-group" style="margin-top: var(--space-16);">
                        <button type="submit" class="btn btn-primary">Add Hotel</button>
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('hotel-form').reset()">Clear</button>
                    </div>
                </form>
            </div>

            <div class="card">
                <h2>All Hotels</h2>
                <input type="text" id="search-hotels" class="search-box" placeholder="Search hotels...">
                <div id="hotels-table"></div>
            </div>
        </div>

        <!-- Import/Export Tab -->
        <div class="tab-content" id="import-export-tab">
            <div class="card">
                <h2>üì• Import Data</h2>
                <p style="margin-bottom: var(--space-16); color: var(--color-text-secondary);">Import customers, hotels, or bookings from Excel files (.xlsx, .xls, or .csv)</p>
                
                <div class="form-group" style="margin-bottom: var(--space-16);">
                    <label>Import Type</label>
                    <select id="import-type">
                        <option value="customers">Customers</option>
                        <option value="hotels">Hotels</option>
                        <option value="bookings">Bookings</option>
                    </select>
                </div>

                <div class="file-input-wrapper">
                    <button class="btn btn-secondary">Choose File</button>
                    <input type="file" id="import-file" accept=".xlsx,.xls,.csv">
                </div>
                <button class="btn btn-primary" onclick="importData()" style="margin-left: var(--space-8);">Import</button>

                <div style="margin-top: var(--space-20); padding: var(--space-16); background-color: rgba(var(--color-teal-500-rgb), 0.05); border-radius: var(--radius-base);">
                    <strong>Expected Format:</strong>
                    <ul style="margin-top: var(--space-8); margin-left: var(--space-20);">
                        <li><strong>Customers:</strong> Name, Email, Phone, Company</li>
                        <li><strong>Hotels:</strong> Name, Location, Standard Rate, Total Rooms, Amenities</li>
                        <li><strong>Bookings:</strong> Customer Email, Hotel Name, Check-in Date (YYYY-MM-DD), Check-out Date (YYYY-MM-DD), Nightly Rate, Extra Night Rate, Notes</li>
                    </ul>
                </div>
            </div>

            <div class="card">
                <h2>üì§ Export Data</h2>
                <p style="margin-bottom: var(--space-16); color: var(--color-text-secondary);">Export all data to Excel for reporting and analysis</p>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="exportToExcel('customers')">Export Customers</button>
                    <button class="btn btn-primary" onclick="exportToExcel('hotels')">Export Hotels</button>
                    <button class="btn btn-primary" onclick="exportToExcel('bookings')">Export Bookings</button>
                    <button class="btn btn-primary" onclick="exportToExcel('all')">Export All Data</button>
                </div>
            </div>

            <div class="card">
                <h2>üóëÔ∏è Data Management</h2>
                <p style="margin-bottom: var(--space-16); color: var(--color-text-secondary);">Clear all data from the system</p>
                <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // IndexedDB Setup
        let db;
        const DB_NAME = 'HotelBookingDB';
        const DB_VERSION = 1;

        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };

                request.onupgradeneeded = (event) => {
                    db = event.target.result;

                    if (!db.objectStoreNames.contains('customers')) {
                        const customerStore = db.createObjectStore('customers', { keyPath: 'id', autoIncrement: true });
                        customerStore.createIndex('email', 'email', { unique: true });
                        customerStore.createIndex('name', 'name', { unique: false });
                    }

                    if (!db.objectStoreNames.contains('hotels')) {
                        const hotelStore = db.createObjectStore('hotels', { keyPath: 'id', autoIncrement: true });
                        hotelStore.createIndex('name', 'name', { unique: false });
                    }

                    if (!db.objectStoreNames.contains('bookings')) {
                        const bookingStore = db.createObjectStore('bookings', { keyPath: 'id', autoIncrement: true });
                        bookingStore.createIndex('customerId', 'customerId', { unique: false });
                        bookingStore.createIndex('hotelId', 'hotelId', { unique: false });
                    }
                };
            });
        }

        // CRUD Operations
        function addRecord(storeName, data) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.add(data);

                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        function getAllRecords(storeName) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();

                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        function updateRecord(storeName, data) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.put(data);

                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        function deleteRecord(storeName, id) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.delete(id);

                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        // UI Functions
        function showMessage(message, type = 'success') {
            const container = document.getElementById('message-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            container.appendChild(messageDiv);

            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // Tab Navigation
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');

                if (tab.dataset.tab === 'dashboard') {
                    updateDashboard();
                }
            });
        });

        // Customer Management
        document.getElementById('customer-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const customer = {
                name: document.getElementById('customer-name').value,
                email: document.getElementById('customer-email').value,
                phone: document.getElementById('customer-phone').value,
                company: document.getElementById('customer-company').value,
                createdAt: new Date().toISOString()
            };

            try {
                await addRecord('customers', customer);
                showMessage('Customer added successfully!');
                document.getElementById('customer-form').reset();
                loadCustomers();
                updateCustomerDropdown();
            } catch (error) {
                showMessage('Error adding customer: ' + error.message, 'error');
            }
        });

        async function loadCustomers() {
            const customers = await getAllRecords('customers');
            const searchTerm = document.getElementById('search-customers').value.toLowerCase();
            const filtered = customers.filter(c => 
                c.name.toLowerCase().includes(searchTerm) ||
                c.email.toLowerCase().includes(searchTerm) ||
                (c.company && c.company.toLowerCase().includes(searchTerm))
            );

            const tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Company</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filtered.map(c => `
                            <tr>
                                <td>${c.name}</td>
                                <td>${c.email}</td>
                                <td>${c.phone || '-'}</td>
                                <td>${c.company || '-'}</td>
                                <td>
                                    <button class="btn btn-danger action-btn" onclick="deleteCustomer(${c.id})">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('customers-table').innerHTML = tableHtml;
        }

        async function deleteCustomer(id) {
            if (confirm('Are you sure you want to delete this customer?')) {
                await deleteRecord('customers', id);
                showMessage('Customer deleted successfully!');
                loadCustomers();
                updateCustomerDropdown();
            }
        }

        async function updateCustomerDropdown() {
            const customers = await getAllRecords('customers');
            const select = document.getElementById('booking-customer');
            select.innerHTML = '<option value="">Select Customer</option>';
            customers.forEach(c => {
                select.innerHTML += `<option value="${c.id}">${c.name} (${c.email})</option>`;
            });
        }

        // Hotel Management
        document.getElementById('hotel-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Collect room types
            const roomTypes = [];
            document.querySelectorAll('.room-type-entry').forEach(entry => {
                const name = entry.querySelector('.room-type-name').value.trim();
                const count = parseInt(entry.querySelector('.room-type-count').value) || 0;
                const rate = parseFloat(entry.querySelector('.room-type-rate').value) || 0;
                
                if (name) {
                    roomTypes.push({ name, availableRooms: count, rate });
                }
            });

            const hotel = {
                name: document.getElementById('hotel-name').value,
                location: document.getElementById('hotel-location').value,
                standardRate: parseFloat(document.getElementById('hotel-standard-rate').value) || 0,
                totalRooms: parseInt(document.getElementById('hotel-rooms').value) || 0,
                amenities: document.getElementById('hotel-amenities').value,
                roomTypes: roomTypes,
                createdAt: new Date().toISOString()
            };

            try {
                await addRecord('hotels', hotel);
                showMessage('Hotel added successfully!');
                document.getElementById('hotel-form').reset();
                loadHotels();
                updateHotelDropdown();
            } catch (error) {
                showMessage('Error adding hotel: ' + error.message, 'error');
            }
        });

        async function loadHotels() {
            const hotels = await getAllRecords('hotels');
            const searchTerm = document.getElementById('search-hotels').value.toLowerCase();
            const filtered = hotels.filter(h => 
                h.name.toLowerCase().includes(searchTerm) ||
                h.location.toLowerCase().includes(searchTerm)
            );

            const tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Location</th>
                            <th>Standard Rate</th>
                            <th>Total Rooms</th>
                            <th>Room Types</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filtered.map(h => {
                            const roomTypesDisplay = h.roomTypes && h.roomTypes.length > 0
                                ? h.roomTypes.map(rt => `${rt.name} (${rt.availableRooms} available, $${rt.rate.toFixed(2)})`).join('<br>')
                                : '-';
                            
                            return `
                                <tr>
                                    <td>${h.name}</td>
                                    <td>${h.location}</td>
                                    <td>$${h.standardRate.toFixed(2)}</td>
                                    <td>${h.totalRooms}</td>
                                    <td style="font-size: 12px;">${roomTypesDisplay}</td>
                                    <td>
                                        <button class="btn btn-danger action-btn" onclick="deleteHotel(${h.id})">Delete</button>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('hotels-table').innerHTML = tableHtml;
        }

        async function deleteHotel(id) {
            if (confirm('Are you sure you want to delete this hotel?')) {
                await deleteRecord('hotels', id);
                showMessage('Hotel deleted successfully!');
                loadHotels();
                updateHotelDropdown();
            }
        }

        async function updateHotelDropdown() {
            const hotels = await getAllRecords('hotels');
            const select = document.getElementById('booking-hotel');
            select.innerHTML = '<option value="">Select Hotel</option>';
            hotels.forEach(h => {
                select.innerHTML += `<option value="${h.id}">${h.name} - ${h.location}</option>`;
            });
        }

        // Booking Management
        document.getElementById('booking-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const checkinDate = new Date(document.getElementById('booking-checkin').value);
            const checkoutDate = new Date(document.getElementById('booking-checkout').value);
            const nights = Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24));

            if (nights <= 0) {
                showMessage('Check-out date must be after check-in date', 'error');
                return;
            }

            const nightly = parseFloat(document.getElementById('booking-rate').value);
            const extraRate = parseFloat(document.getElementById('booking-extra-rate').value) || 0;

            const booking = {
                customerId: parseInt(document.getElementById('booking-customer').value),
                hotelId: parseInt(document.getElementById('booking-hotel').value),
                checkinDate: document.getElementById('booking-checkin').value,
                checkoutDate: document.getElementById('booking-checkout').value,
                nights: nights,
                nightlyRate: nightly,
                extraNightRate: extraRate,
                totalCost: (nightly * nights) + (extraRate * nights),
                notes: document.getElementById('booking-notes').value,
                createdAt: new Date().toISOString()
            };

            try {
                await addRecord('bookings', booking);
                showMessage('Booking added successfully!');
                document.getElementById('booking-form').reset();
                loadBookings();
            } catch (error) {
                showMessage('Error adding booking: ' + error.message, 'error');
            }
        });

        async function loadBookings() {
            const bookings = await getAllRecords('bookings');
            const customers = await getAllRecords('customers');
            const hotels = await getAllRecords('hotels');
            const searchTerm = document.getElementById('search-bookings').value.toLowerCase();

            const bookingsWithDetails = bookings.map(b => {
                const customer = customers.find(c => c.id === b.customerId);
                const hotel = hotels.find(h => h.id === b.hotelId);
                return {
                    ...b,
                    customerName: customer ? customer.name : 'Unknown',
                    hotelName: hotel ? hotel.name : 'Unknown'
                };
            });

            const filtered = bookingsWithDetails.filter(b => 
                b.customerName.toLowerCase().includes(searchTerm) ||
                b.hotelName.toLowerCase().includes(searchTerm)
            );

            const tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Hotel</th>
                            <th>Check-in</th>
                            <th>Check-out</th>
                            <th>Nights</th>
                            <th>Nightly Rate</th>
                            <th>Extra Rate</th>
                            <th>Total Cost</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filtered.map(b => `
                            <tr>
                                <td>${b.customerName}</td>
                                <td>${b.hotelName}</td>
                                <td>${b.checkinDate}</td>
                                <td>${b.checkoutDate}</td>
                                <td>${b.nights}</td>
                                <td>$${b.nightlyRate.toFixed(2)}</td>
                                <td>$${b.extraNightRate.toFixed(2)}</td>
                                <td>$${b.totalCost.toFixed(2)}</td>
                                <td>
                                    <button class="btn btn-danger action-btn" onclick="deleteBooking(${b.id})">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('bookings-table').innerHTML = tableHtml;
        }

        async function deleteBooking(id) {
            if (confirm('Are you sure you want to delete this booking?')) {
                await deleteRecord('bookings', id);
                showMessage('Booking deleted successfully!');
                loadBookings();
            }
        }

        // Dashboard
        async function updateDashboard() {
            const bookings = await getAllRecords('bookings');
            const customers = await getAllRecords('customers');
            const hotels = await getAllRecords('hotels');

            document.getElementById('total-bookings').textContent = bookings.length;
            document.getElementById('total-customers').textContent = customers.length;
            document.getElementById('total-hotels').textContent = hotels.length;

            const totalNights = bookings.reduce((sum, b) => sum + b.nights, 0);
            const totalRevenue = bookings.reduce((sum, b) => sum + b.totalCost, 0);

            document.getElementById('total-nights').textContent = totalNights;
            document.getElementById('total-revenue').textContent = `$${totalRevenue.toFixed(2)}`;

            // Recent bookings
            const recentBookings = bookings.slice(-5).reverse();
            const bookingsWithDetails = recentBookings.map(b => {
                const customer = customers.find(c => c.id === b.customerId);
                const hotel = hotels.find(h => h.id === b.hotelId);
                return {
                    ...b,
                    customerName: customer ? customer.name : 'Unknown',
                    hotelName: hotel ? hotel.name : 'Unknown'
                };
            });

            const recentTableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Hotel</th>
                            <th>Check-in</th>
                            <th>Nights</th>
                            <th>Total Cost</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${bookingsWithDetails.map(b => `
                            <tr>
                                <td>${b.customerName}</td>
                                <td>${b.hotelName}</td>
                                <td>${b.checkinDate}</td>
                                <td>${b.nights}</td>
                                <td>$${b.totalCost.toFixed(2)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('recent-bookings-table').innerHTML = recentTableHtml;

            // Hotel statistics
            const hotelStats = hotels.map(h => {
                const hotelBookings = bookings.filter(b => b.hotelId === h.id);
                const nights = hotelBookings.reduce((sum, b) => sum + b.nights, 0);
                const revenue = hotelBookings.reduce((sum, b) => sum + b.totalCost, 0);
                return {
                    name: h.name,
                    bookings: hotelBookings.length,
                    nights: nights,
                    revenue: revenue
                };
            });

            const hotelStatsHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>Hotel</th>
                            <th>Bookings</th>
                            <th>Total Nights</th>
                            <th>Total Revenue</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${hotelStats.map(h => `
                            <tr>
                                <td>${h.name}</td>
                                <td>${h.bookings}</td>
                                <td>${h.nights}</td>
                                <td>$${h.revenue.toFixed(2)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('hotel-stats').innerHTML = hotelStatsHtml;
        }

        // Export to Excel
        async function exportToExcel(type) {
            const wb = XLSX.utils.book_new();

            if (type === 'customers' || type === 'all') {
                const customers = await getAllRecords('customers');
                const ws = XLSX.utils.json_to_sheet(customers.map(c => ({
                    Name: c.name,
                    Email: c.email,
                    Phone: c.phone || '',
                    Company: c.company || '',
                    'Created At': c.createdAt
                })));
                XLSX.utils.book_append_sheet(wb, ws, 'Customers');
            }

            if (type === 'hotels' || type === 'all') {
                const hotels = await getAllRecords('hotels');
                const ws = XLSX.utils.json_to_sheet(hotels.map(h => ({
                    Name: h.name,
                    Location: h.location,
                    'Standard Rate': h.standardRate,
                    'Total Rooms': h.totalRooms,
                    Amenities: h.amenities || '',
                    'Created At': h.createdAt
                })));
                XLSX.utils.book_append_sheet(wb, ws, 'Hotels');
            }

            if (type === 'bookings' || type === 'all') {
                const bookings = await getAllRecords('bookings');
                const customers = await getAllRecords('customers');
                const hotels = await getAllRecords('hotels');

                const bookingsData = bookings.map(b => {
                    const customer = customers.find(c => c.id === b.customerId);
                    const hotel = hotels.find(h => h.id === b.hotelId);
                    return {
                        Customer: customer ? customer.name : 'Unknown',
                        'Customer Email': customer ? customer.email : 'Unknown',
                        Hotel: hotel ? hotel.name : 'Unknown',
                        'Hotel Location': hotel ? hotel.location : 'Unknown',
                        'Check-in': b.checkinDate,
                        'Check-out': b.checkoutDate,
                        'Nights': b.nights,
                        'Nightly Rate': b.nightlyRate,
                        'Extra Night Rate': b.extraNightRate,
                        'Total Cost': b.totalCost,
                        Notes: b.notes || '',
                        'Created At': b.createdAt
                    };
                });

                const ws = XLSX.utils.json_to_sheet(bookingsData);
                XLSX.utils.book_append_sheet(wb, ws, 'Bookings');
            }

            const filename = `hotel-booking-${type}-${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, filename);
            showMessage(`Exported ${type} data successfully!`);
        }

        // Import Data
        async function importData() {
            const fileInput = document.getElementById('import-file');
            const importType = document.getElementById('import-type').value;

            if (!fileInput.files.length) {
                showMessage('Please select a file to import', 'error');
                return;
            }

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = async (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                    let imported = 0;

                    if (importType === 'customers') {
                        for (const row of jsonData) {
                            try {
                                await addRecord('customers', {
                                    name: row.Name || row.name,
                                    email: row.Email || row.email,
                                    phone: row.Phone || row.phone || '',
                                    company: row.Company || row.company || '',
                                    createdAt: new Date().toISOString()
                                });
                                imported++;
                            } catch (error) {
                                console.error('Error importing customer:', error);
                            }
                        }
                        updateCustomerDropdown();
                        loadCustomers();
                    } else if (importType === 'hotels') {
                        for (const row of jsonData) {
                            try {
                                await addRecord('hotels', {
                                    name: row.Name || row.name,
                                    location: row.Location || row.location,
                                    standardRate: parseFloat(row['Standard Rate'] || row.standardRate) || 0,
                                    totalRooms: parseInt(row['Total Rooms'] || row.totalRooms) || 0,
                                    amenities: row.Amenities || row.amenities || '',
                                    createdAt: new Date().toISOString()
                                });
                                imported++;
                            } catch (error) {
                                console.error('Error importing hotel:', error);
                            }
                        }
                        updateHotelDropdown();
                        loadHotels();
                    } else if (importType === 'bookings') {
                        const customers = await getAllRecords('customers');
                        const hotels = await getAllRecords('hotels');

                        for (const row of jsonData) {
                            try {
                                const customerEmail = row['Customer Email'] || row.customerEmail;
                                const hotelName = row.Hotel || row.hotel;
                                
                                const customer = customers.find(c => c.email === customerEmail);
                                const hotel = hotels.find(h => h.name === hotelName);

                                if (!customer || !hotel) {
                                    console.error('Customer or hotel not found for booking');
                                    continue;
                                }

                                const checkinDate = new Date(row['Check-in'] || row.checkin);
                                const checkoutDate = new Date(row['Check-out'] || row.checkout);
                                const nights = Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24));

                                await addRecord('bookings', {
                                    customerId: customer.id,
                                    hotelId: hotel.id,
                                    checkinDate: checkinDate.toISOString().split('T')[0],
                                    checkoutDate: checkoutDate.toISOString().split('T')[0],
                                    nights: nights,
                                    nightlyRate: parseFloat(row['Nightly Rate'] || row.nightlyRate) || 0,
                                    extraNightRate: parseFloat(row['Extra Night Rate'] || row.extraNightRate) || 0,
                                    totalCost: parseFloat(row['Total Cost'] || row.totalCost) || 0,
                                    notes: row.Notes || row.notes || '',
                                    createdAt: new Date().toISOString()
                                });
                                imported++;
                            } catch (error) {
                                console.error('Error importing booking:', error);
                            }
                        }
                        loadBookings();
                    }

                    showMessage(`Successfully imported ${imported} ${importType}!`);
                    fileInput.value = '';
                } catch (error) {
                    showMessage('Error importing data: ' + error.message, 'error');
                }
            };

            reader.readAsArrayBuffer(file);
        }

        // Clear All Data
        async function clearAllData() {
            if (!confirm('Are you sure you want to delete ALL data? This cannot be undone!')) {
                return;
            }

            try {
                const bookings = await getAllRecords('bookings');
                const customers = await getAllRecords('customers');
                const hotels = await getAllRecords('hotels');

                for (const b of bookings) {
                    await deleteRecord('bookings', b.id);
                }
                for (const c of customers) {
                    await deleteRecord('customers', c.id);
                }
                for (const h of hotels) {
                    await deleteRecord('hotels', h.id);
                }

                showMessage('All data cleared successfully!');
                loadCustomers();
                loadHotels();
                loadBookings();
                updateCustomerDropdown();
                updateHotelDropdown();
                updateDashboard();
            } catch (error) {
                showMessage('Error clearing data: ' + error.message, 'error');
            }
        }

        // Room Type Management
        function addRoomTypeField() {
            const container = document.getElementById('room-types-container');
            const newEntry = document.createElement('div');
            newEntry.className = 'room-type-entry';
            newEntry.style.cssText = 'display: grid; grid-template-columns: 2fr 1fr 1fr 60px; gap: var(--space-8); margin-bottom: var(--space-8); align-items: end;';
            newEntry.innerHTML = `
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Room Type Name</label>
                    <input type="text" class="room-type-name" placeholder="e.g., Deluxe Suite">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Available Rooms</label>
                    <input type="number" class="room-type-count" min="0" placeholder="0">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Rate ($)</label>
                    <input type="number" class="room-type-rate" step="0.01" min="0" placeholder="0.00">
                </div>
                <button type="button" class="btn btn-danger" onclick="removeRoomType(this)" style="padding: var(--space-8);">‚úï</button>
            `;
            container.appendChild(newEntry);
        }

        function removeRoomType(button) {
            const container = document.getElementById('room-types-container');
            if (container.children.length > 1) {
                button.closest('.room-type-entry').remove();
            } else {
                showMessage('At least one room type entry must remain', 'error');
            }
        }

        // Search functionality
        document.getElementById('search-customers').addEventListener('input', loadCustomers);
        document.getElementById('search-hotels').addEventListener('input', loadHotels);
        document.getElementById('search-bookings').addEventListener('input', loadBookings);

        // Initialize
        initDB().then(() => {
            loadCustomers();
            loadHotels();
            loadBookings();
            updateCustomerDropdown();
            updateHotelDropdown();
            updateDashboard();
            showMessage('Hotel Booking Management Platform loaded successfully!');
        });
    </script>
</body>
</html>

